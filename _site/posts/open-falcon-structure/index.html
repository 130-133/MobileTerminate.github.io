<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title> open-falcon 架构</title><meta name="description" content="公司最近要用小米的open-falcon做监控，今天对其架构进行了一番了解。"><link rel="canonical" href="http://localhost:4000/posts/open-falcon-structure/"><link rel="alternate" type="application/rss+xml" title="Leo's Freedom House" href="http://localhost:4000/feed.xml"><link href='https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|Roboto+Condensed:700&subset=latin' rel='stylesheet' type='text/css'><link rel="stylesheet" href="/assets/css/main.css"><meta property="og:url" content="http://localhost:4000/posts/open-falcon-structure/"><meta property="og:type" content="website"><meta property="og:title" content="open-falcon 架构"><meta property="og:description" content="open-falcon 架构"><meta property="og:site_name" content="Leo's Freedom House"><meta name="twitter:card" content="summary"><meta name="twitter:url" content="http://localhost:4000/posts/open-falcon-structure/"><meta name="twitter:title" content="open-falcon 架构"><meta name="twitter:description" content="open-falcon 架构"><meta property="og:image" content="http://localhost:4000/assets/images/coding.png"><meta name="twitter:image" content="http://localhost:4000/assets/images/coding.png"><body><div id="shadow"></div><header class="main-header content-wrapper"> <input type="checkbox" id="menu-checkbox" /><nav class="center-wrapper nav-main"> <a class="blog-logo" href="/">Leo's Freedom House</a> <a href="/about/">About</a> <a href="/posts/">Archive</a> <a href="/feed.xml">RSS</a> <label for="menu-checkbox" class="toggle-button" data-open="☰" data-close="☰" onclick></label></nav></header><aside class="sidebar" role="note" style="background-image: url(/assets/images/coding.png)"><div class="cover"><div class="cover-text"><div class="heading"> <a href="/posts/#open-falcon">open-falcon</a></div><p> open-falcon 架构</div></div><div id="switcher"></div></aside><main class="content-wrapper"><article class="post"><h1 class="post-title">open-falcon 架构</h1><p class="post-meta"> <time datetime="2018-11-05">05-11-2018</time> &nbsp;/&nbsp; <span>leo</span><div class="post-content"><p>公司最近要用小米的<code class="highlighter-rouge">open-falcon</code>做监控，今天对其架构进行了一番了解。 <img src="/assets/images/open_falcon.png" alt="open_falcon_structure" /><h2 id="基本组成模块">基本组成模块：</h2><ol><li>falcon-agent:<strong>数据采集组件</strong>。接收客户端用户数据上报，上报给transfer处理程序。<li>transfer:<strong>数据中转模块</strong>。负责将agent发来的数据转发到judge和graph。<li>judge:<strong>告警判断模块</strong>。根据规则判定收到的数据是否达到报警阈值，若达到则触发报警。<li>alarm:<strong>告警模块</strong>。发出各种渠道的报警消息。<li>graph:<strong>数据存储模块</strong>。上报数据的存储、归档。并提供查询接口<li>query:<strong>查询模块</strong>。给外部提供查询graph中的http接口。<li>dashboard:<strong>前端查询管理页面</strong>，通过query提供的几口查询上报数据。<li>web portal:<strong>配置告警策略模块</strong>。<li>heartbeat server:提供心跳服务及策略缓存。</ol><h2 id="数据上报及处理流程">数据上报及处理流程：</h2><ol><li>客户端通过http上报数据给agent<li>agent接收到客户端上报的数据，并通过长连接将数据上报给transfer<li>transfer将收到的数据分别转发给judge集群和graph集群，使用一致性hash做数据分片，一个judge实例或一个graph实例值处理一部分数据<li>如果judge中判定到了需要告警的事件，则会将该事件推入Redis队列<li>alarm从Redis队列中取告警事件，将告警消息发送给对应渠道<li>graph将收到的数据存储并归档，其提供查询接口给query模块<li>query模块提供外部接口给web前端的dashboard，用于查询graph中存储的上报数据<li>web portal模块用于配置监控策略，并将策略存储到数据库中<li>heartbeat server为心跳服务器，agent每分钟都会发送心跳给heartbeat server，并上报自己的版本，hostname，ip等信息。<li>agent需要获取监控策略中的插件、特殊采集项、IP白名单下发等数据，judge集群在每次进行告警判定的时候也需要从监控策略中拉取判定条件。由于judge实例可能比较多，如果每次都去连接web portal db的话会给db造成比较大的压力。因为agent是通过heartbeat server去web portal db中去获取数据的，因此将heartbeat server作为了web portal db的一层cache，使得judge每次进行告警判定的时候都从heartbeat server获取告警策略，极大的减轻db的压力。</ol><p>以上就是open-falcon的整体架构啦。 附上<a href="https://www.jikexueyuan.com/course/1651_1.html?ss=1">官方视频教程链接</a><hr /><p>最后，由于官方给出的搭建open-falcon的文档有一些坑，故此给出笔者验证过可用的<a href="https://www.cnblogs.com/straycats/p/7199209.html">open-falcon搭建教程</a><div class="post-links"> <a class="link-to-post" href="/posts/test-article/"> <span class="link-to-post__prev">&#10535; &nbsp;Previous post</span> <span class="link-to-post__title">Test title</span> </a></div></div></article></main><footer class="blog-footer content-wrapper"><p>&copy; <span class="full-year"></span> Leo's Freedom House</footer><script src="/assets/js/scripts.js"></script>
